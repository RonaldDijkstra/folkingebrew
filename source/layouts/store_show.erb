<%
if current_article.data.images
  product_image = current_article.data.images.first
end
%>

<% wrap_layout :layout do %>
  <header class="normal-page-header">
    <div class="grid-row">
      <h1>
        <%= t("pages.store.title") %>
      </h1>
    </div>
  </header>
  <section class="product wide-row">
    <div class="grid-row product-item">
      <figure class="product-figure">
        <picture>
          <%= image_tag product_image, alt: current_article.title, class: "product-image" %>
        </picture>

        <% if current_article.data.images.count > 1 %>
          <nav class="thumbnails">
            <% current_article.data.images.each_with_index do |image, index| %>
              <% if index == 0 %>
                <button class="">
              <% else %>
                <button class="">
              <% end %>
                  <picture>
                    <%= image_tag image, alt: current_article.title, class: "product-thumbnail" %>
                  </picture>
                </button>
            <% end %>
          </nav>
        <% end %>
      </figure>
      <div class="product-content">
        <h2>
          <%= current_article.title %>
        </h2>
        <p class="price">
          <%= number_to_currency(current_page.data.price, :unit => "â‚¬").gsub!(/\./,",") %>
        </p>
        <p class="vat">
          Incl. VAT
        </p>

        <%= yield %>

        <div class="product-controls">
          <% if current_article.data.sizes %>
            <div class="sizes">
              <label>
                Size
              </label>
              <div class="select">
                <select id="size" name="size">
                  <% current_article.data.sizes.each do |size| %>
                    <% if size.stock %>
                      <option value="<%= size.title %>"><%= size.title %></option>
                    <% else %>
                      <option value="<%= size.title %>" disabled><%= size.title %> (Out of Stock)</option>
                    <% end %>
                  <% end %>
                </select>
              </div>
            </div>
          <% end %>
          <div class="quantity-and-cart">
            <% unless current_article.data.max_quantity == 1 || current_page.data.out_of_stock %>
              <div class="product-quantity">
                <label>
                  Quantity <%= "(max #{current_article.data.max_quantity} pp)" if current_article.data.max_quantity %>
                </label>
                <% if current_article.data.max_quantity %>
                  <input class="product-quantity-input" type="number" name="quantity" id="quantity" value="1" min="1" max="<%= current_article.data.max_quantity %>">
                <% else %>
                  <input class="product-quantity-input" type="number" name="quantity" id="quantity" value="1" min="1">
                <% end %>
              </div>
            <% end %>
            <div class="add-to-cart">
              <% if current_page.data.out_of_stock %>
                <% content_tag :button, class: "button green medium-size full-width solid", :disabled => "disabled" do %>
                  Out of Stock
                <% end %>
              <% else %>
                <%= partial "partials/store/_snipcart_button", locals: { product: current_article, variant: "medium-size solid green buy-button" } %>
              <% end %>
            </div>
          </div>

          <div class="shipping-conditions">
            <%= partial "content/shipping-conditions" %>
          </div>
        </div>
      </div>
    </div>
    <div class="grid-row back-link">
      <%= partial "partials/button", locals: { to: "/store/index.html",
                                               variant: "medium-size ghost no-border green",
                                               icon_left: "icons/arrow-left.svg",
                                               text: t("webshop.back_to_all_products")} %>
    </div>
  </section>
<% end %>
